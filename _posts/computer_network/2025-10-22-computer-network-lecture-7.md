---
layout: post
title: "🌐 네트워크의 진화: NAT, IPv6, 그리고 SDN 7️⃣"
date: 2025-10-22 20:00:00 +0900
categories: [computer_network]
tags: [CS, Network, NAT, IPv6, SDN, OpenFlow, Middlebox]
---

# 🤯 네트워크의 한계를 넘어서

지난 시간에는 전송 계층에서 어떻게 신뢰성 있는 데이터를 보내는지 알아봤다. 오늘은 네트워크 계층의 주소 부족 문제를 해결하는 기발한 방법들과, 네트워크가 점점 더 똑똑해지는 미래에 대해 알아보자. 바로 **NAT**, **IPv6**, 그리고 **SDN**의 세계다!

## 1. NAT: IP 주소를 아껴 쓰는 마법 🎩

**NAT(Network Address Translation)** 는 로컬(사설) 네트워크의 여러 기기가 **단 하나의 공인(Public) IPv4 주소**를 공유하게 해주는 기술이다. 우리 집 공유기를 생각하면 쉽다. 여러 대의 스마트폰과 노트북이 하나의 인터넷 회선을 통해 외부 세상과 통신할 수 있는 건 바로 NAT 덕분이다.

- **어떻게 작동할까?**
    - NAT 장치(주로 라우터)는 내부에서 외부로 나가는 데이터그램의 `출발지 사설 IP 주소`와 `포트 번호`를 자신의 `공인 IP 주소`와 `새로운 포트 번호`로 바꿔치기한다.
    - 이 변환 정보는 **NAT translation table**에 기록된다.
    - 외부에서 응답이 오면, 테이블을 참조해서 원래의 사설 IP와 포트 번호로 되돌려 정확한 기기에게 전달해준다.

- **장점**
    - ISP로부터 받은 IP 주소 하나로 여러 기기를 쓸 수 있다. (비용 절감! 💰)
    - 외부에서 내부 네트워크 구조를 직접 알 수 없어 보안에 도움이 된다.
    - 내부 네트워크의 기기 주소를 마음대로 변경해도 외부에 영향을 주지 않는다.

하지만 NAT는 "꼼수"라는 비판도 받는다. 라우터는 3계층 장비인데 포트 번호(4계층 정보)를 수정하는 것은 원칙에 어긋나고, end-to-end 원칙을 깨뜨린다는 이유다. 그럼에도 불구하고 NAT는 주소 고갈 문제를 해결하는 현실적인 대안으로 널리 사용되고 있다.

## 2. IPv6: 고갈되지 않는 주소의 시대 🚀

IPv4의 32비트 주소 공간(약 43억 개)은 이미 오래전에 고갈되었다. 이를 근본적으로 해결하기 위해 등장한 것이 바로 **IPv6**다.

- **주요 특징**
    - **거대한 주소 공간:** 128비트 주소 체계를 사용하므로 사실상 무한대에 가까운 주소를 할당할 수 있다.
    - **헤더 단순화:** 헤더 길이를 40바이트로 고정하고, 체크섬, 단편화/재조립 같은 불필요한 필드를 제거하여 라우터의 처리 속도를 높였다.
    - **QoS 지원:** `priority` 필드를 이용해 특정 트래픽(e.g., 실시간 영상)을 우선 처리할 수 있도록 설계되었다.

![Untitled](/assets/images/computer_network_7/Untitled.png)

- **IPv4와의 전환: 터널링(Tunneling)**
    - IPv4와 IPv6는 서로 호환되지 않는다. 그래서 모든 네트워크가 한 번에 IPv6로 바뀔 수는 없다.
    - 이 문제를 해결하기 위해 **터널링**이라는 기법을 사용한다. IPv6 패킷을 IPv4 패킷의 **데이터(payload) 부분에 통째로 넣어서** IPv4 네트워크를 통과하는 방식이다.
    - 마치 IPv6라는 승객을 태운 자동차(IPv4 패킷)가 IPv4 전용 도로를 달리는 것과 같다.

![Untitled](/assets/images/computer_network_7/Untitled%201.png)

![Untitled](/assets/images/computer_network_7/Untitled%202.png)

아직 많은 곳에서 NAT와 같은 방법으로 IPv4를 사용하고 있지만, 점차 IPv6로의 전환이 이루어지고 있다.

## 3. Generalized Forwarding & SDN: 똑똑해지는 네트워크 🧠

기존의 라우터는 오직 **목적지 IP 주소**만 보고 패킷을 어디로 보낼지 결정했다. 하지만 네트워크가 복잡해지면서 더 유연하고 지능적인 제어가 필요해졌다.

- **Match plus Action:**
    - "목적지 IP 주소만 본다"는 규칙에서 벗어나, **다양한 헤더 필드(MAC 주소, 포트 번호 등)를 조합(Match)** 하여, **미리 정의된 다양한 동작(Action)**(e.g., 전달, 폐기, 수정, 복사)을 수행하는 패러다임이다.
    - 이 규칙들의 집합을 **Flow Table**이라고 한다.

![Untitled](/assets/images/computer_network_7/Untitled%204.png)

이러한 아이디어를 표준화한 것이 **OpenFlow** 프로토콜이며, 이를 통해 네트워크 전체를 소프트웨어로 중앙에서 제어하고 프로그래밍하는 기술을 **SDN(Software-Defined Networking)** 이라고 부른다.

SDN을 이용하면 방화벽, 로드 밸런서, NAT 같은 기능들을 더 이상 비싼 전용 장비가 아니라, 일반적인 하드웨어 위에서 소프트웨어로 구현하고 중앙에서 관리할 수 있게 된다. (이를 **NFV, 네트워크 기능 가상화**라고 한다.)

## 4. Middleboxes와 End-to-End 원칙의 변화

- **미들박스(Middleboxes):** 네트워크 경로 중간에서 단순한 패킷 포워딩 이상의 기능을 수행하는 장치들을 말한다. (e.g., NAT, 방화벽, 로드 밸런서)
- **End-to-End Argument:** "지능적인 기능은 네트워크의 양 끝단(end system)에 위치해야 하고, 네트워크 내부는 단순한 데이터 전달에만 집중해야 한다"는 인터넷의 초기 설계 원칙이다.

과거에는 이 원칙이 중요하게 여겨졌지만, 보안과 성능 향상 등의 현실적인 요구로 인해 방화벽, NAT 같은 미들박스들이 등장하면서 네트워크 중간(in-network)에서도 점점 더 많은 일들을 처리하게 되었다.

![Untitled](/assets/images/computer_network_7/Untitled%209.png)
*(IP를 중심으로 한 모래시계 모델)*

![Untitled](/assets/images/computer_network_7/Untitled%2010.png)
*(미들박스로 인해 허리가 두꺼워진 현대의 인터넷)*

이처럼 네트워크는 단순히 데이터를 전달하는 파이프에서 벗어나, 스스로 상황을 판단하고 트래픽을 제어하는 지능적인 플랫폼으로 진화하고 있다.
